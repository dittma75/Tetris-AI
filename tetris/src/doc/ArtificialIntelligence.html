<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=IBM437" http-equiv="Content-Type">

<title>class ArtificialIntelligence - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/artificial_intelligence.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="Object.html">Object</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-checkForDeepWells">#checkForDeepWells</a>
    
    <li><a href="#method-i-checkForNearDeathPlacement">#checkForNearDeathPlacement</a>
    
    <li><a href="#method-i-getBestMove">#getBestMove</a>
    
    <li><a href="#method-i-getBlocksInRewardZone">#getBlocksInRewardZone</a>
    
    <li><a href="#method-i-getHeightModifier">#getHeightModifier</a>
    
    <li><a href="#method-i-getHeuristic">#getHeuristic</a>
    
    <li><a href="#method-i-getHighestOccupiedRow">#getHighestOccupiedRow</a>
    
    <li><a href="#method-i-getHolesBelowTetromino">#getHolesBelowTetromino</a>
    
    <li><a href="#method-i-getLinesMade">#getLinesMade</a>
    
    <li><a href="#method-i-tryMoves">#tryMoves</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ArtificialIntelligence.html">ArtificialIntelligence</a>
  
    <li><a href="./BackwardLBlock.html">BackwardLBlock</a>
  
    <li><a href="./Block.html">Block</a>
  
    <li><a href="./Board.html">Board</a>
  
    <li><a href="./LBlock.html">LBlock</a>
  
    <li><a href="./LineBlock.html">LineBlock</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./SBlock.html">SBlock</a>
  
    <li><a href="./SquareBlock.html">SquareBlock</a>
  
    <li><a href="./TBlock.html">TBlock</a>
  
    <li><a href="./TetrisWindow.html">TetrisWindow</a>
  
    <li><a href="./Tetromino.html">Tetromino</a>
  
    <li><a href="./ZBlock.html">ZBlock</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ArtificialIntelligence</h1>

  <div id="description" class="description">
    
<p>Approach:  The current state of the board will be fed into the
getBestMove() function, which will evaluate the heuristics for each
potential move (rotations included) for a Tetris block.  Heuristics will be
calculated by the heuristic() function.  The move sequence returned by
getBestMove() will be the best move according to the heuristics.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="NEAR_DEATH_THRESHOLD">NEAR_DEATH_THRESHOLD
        
        <dd class="description"><p>Row number that tells the AI that it is close to losing</p>
        
      
        <dt id="UNSAFE_THRESHOLD">UNSAFE_THRESHOLD
        
        <dd class="description"><p>Row number that tells the AI that it shouldn't be taking risks to improve
its score</p>
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(board, tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Constructor param board is the board to use for deciding on a move param
tetromino is the tetromino that needs to be placed on the board by the <a
href="ArtificialIntelligence.html">ArtificialIntelligence</a>.</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">board</span>, <span class="ruby-identifier">tetromino</span>)
  <span class="ruby-comment"># Make a copy of the board and tetromino for us to safely use</span>
  <span class="ruby-ivar">@board</span> = <span class="ruby-constant">DeepClone</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-identifier">board</span>)
  <span class="ruby-ivar">@tetromino</span> = <span class="ruby-constant">DeepClone</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-identifier">tetromino</span>)
  
  <span class="ruby-comment"># Clear the tetromino from the board just to make sure.</span>
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">removeTetromino</span>(<span class="ruby-ivar">@tetromino</span>)
  
  <span class="ruby-comment"># Move the tetromino down so there's room to rotate it</span>
  <span class="ruby-ivar">@tetromino</span>.<span class="ruby-identifier">moveDown</span>()
  
  <span class="ruby-comment"># The reward row awards positive points to a tetromino placement that is</span>
  <span class="ruby-comment"># at or below this row.</span>
  <span class="ruby-ivar">@reward_row</span> = <span class="ruby-identifier">getHighestOccupiedRow</span>()
  
  <span class="ruby-comment"># An arbitrarily bad starting heuristic</span>
  <span class="ruby-ivar">@best_heuristic</span> = <span class="ruby-value">-999999</span>
  <span class="ruby-ivar">@best_move</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-checkForDeepWells" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">checkForDeepWells</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Get a heuristic value based on the number of columns below the reward row
with 3 or more contiguous empty cells. param tetromino is the tetromino
location to use for the heuristic. return the heuristic value based on the
number of deep wells</p>
          

          
          <div class="method-source-code" id="checkForDeepWells-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 266</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">checkForDeepWells</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">addTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">deep_wells</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">col_index</span> <span class="ruby-keyword">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-constant">Board</span><span class="ruby-operator">::</span><span class="ruby-constant">COLUMNS</span>
    <span class="ruby-identifier">column</span> = <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">getColumnBelowRow</span>(<span class="ruby-ivar">@reward_row</span>, <span class="ruby-identifier">col_index</span>)
    
    <span class="ruby-comment"># Keep a count of the contiguous empty cells.  A deep well</span>
    <span class="ruby-comment"># is a column of holes 3 cells long or larger.</span>
    <span class="ruby-identifier">empty_cell_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">column</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># If the cell is empty, add to the contiguous cell count.</span>
      <span class="ruby-comment"># Otherwise, reset the count.</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cell</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Tetromino</span><span class="ruby-operator">::</span><span class="ruby-constant">EMPTY</span>)
        <span class="ruby-identifier">empty_cell_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">empty_cell_count</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      
      <span class="ruby-comment"># There's a deep well in this column.  Mark it and</span>
      <span class="ruby-comment"># start checking the next column.</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">empty_cell_count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">4</span>)
        <span class="ruby-identifier">deep_wells</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">empty_cell_count</span> = <span class="ruby-value">0</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">removeTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-value">-40</span> * <span class="ruby-identifier">deep_wells</span> * <span class="ruby-identifier">deep_wells</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- checkForDeepWells-source -->
          
        </div>

        

        
      </div><!-- checkForDeepWells-method -->

    
      <div id="method-i-checkForNearDeathPlacement" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">checkForNearDeathPlacement</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Prioritize against placing blocks within the first 7 rows of the top of the
board because it can cause the AI to build a tower to its premature death.
param tetromino is the tetromino location to use for the heuristic. return
-150 if a tetromino block is near the top of the board and 0 otherwise.</p>
          

          
          <div class="method-source-code" id="checkForNearDeathPlacement-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">checkForNearDeathPlacement</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">tetromino</span>.<span class="ruby-identifier">getBlocks</span>().<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">block</span>.<span class="ruby-identifier">getRow</span>() <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">UNSAFE_THRESHOLD</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-value">-150</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- checkForNearDeathPlacement-source -->
          
        </div>

        

        
      </div><!-- checkForNearDeathPlacement-method -->

    
      <div id="method-i-getBestMove" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getBestMove</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>return an array containing the best move sequence and the time that it took
to do the move calculation.  The time will be used to do the proper number
of gravity moves.</p>
          

          
          <div class="method-source-code" id="getBestMove-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getBestMove</span>()
  <span class="ruby-comment"># Get the highest row (closest to 0) with a non-empty</span>
  <span class="ruby-comment"># block.  This is the top of the reward area.</span>
  
  <span class="ruby-comment"># Iterate through all options for the tetromino with</span>
  <span class="ruby-comment"># each rotation considered.</span>
  
  <span class="ruby-comment"># Must be done without the Tetromino on the board because it will mess it up.</span>
  <span class="ruby-identifier">start</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  
  <span class="ruby-comment"># Figure out how many orientations we have to try for this tetromino.</span>
  <span class="ruby-identifier">rotation</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">case</span> (<span class="ruby-ivar">@tetromino</span>.<span class="ruby-identifier">getRotationType</span>())
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Tetromino</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_ROTATION</span>
    <span class="ruby-identifier">rotation</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Tetromino</span><span class="ruby-operator">::</span><span class="ruby-constant">TWO_ROTATION</span>
    <span class="ruby-identifier">rotation</span> = <span class="ruby-value">2</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Tetromino</span><span class="ruby-operator">::</span><span class="ruby-constant">FOUR_ROTATION</span>
    <span class="ruby-identifier">rotation</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">abort</span>(<span class="ruby-node">&quot;No rotation type specified for type #{@type} tetromino&quot;</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># We have to check every possible rotation of the tetromino.</span>
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">rot</span> <span class="ruby-keyword">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">rotation</span>
    <span class="ruby-identifier">tryMoves</span>(<span class="ruby-identifier">rot</span>)
    <span class="ruby-ivar">@tetromino</span>.<span class="ruby-identifier">rotateLeft</span>()
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">elapsed_time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@best_move</span>, <span class="ruby-identifier">elapsed_time</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getBestMove-source -->
          
        </div>

        

        
      </div><!-- getBestMove-method -->

    
      <div id="method-i-getBlocksInRewardZone" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getBlocksInRewardZone</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>param tetromino is the tetromino location to use for the heuristic. param
reward_row is the highest occupied row before the tetromino is placed.
return the number of blocks that are part of the tetromino and within the
reward zone multiplied by 5</p>
          

          
          <div class="method-source-code" id="getBlocksInRewardZone-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getBlocksInRewardZone</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">positive_h</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">tetromino</span>.<span class="ruby-identifier">getBlocks</span>().<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">block</span>.<span class="ruby-identifier">getRow</span>() <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@reward_row</span>)
      <span class="ruby-identifier">positive_h</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">positive_h</span> * <span class="ruby-value">5</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getBlocksInRewardZone-source -->
          
        </div>

        

        
      </div><!-- getBlocksInRewardZone-method -->

    
      <div id="method-i-getHeightModifier" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getHeightModifier</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Try to keep the board of an even height. param tetromino is the tetromino
location to use for the heuristic. return a heuristic value that favors
tetrominoes below the reward row rather than above it.</p>
          

          
          <div class="method-source-code" id="getHeightModifier-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 251</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getHeightModifier</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">height_modifier</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">tetromino</span>.<span class="ruby-identifier">getBlocks</span>().<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># reward row should be height than block row for good moves</span>
    <span class="ruby-comment"># higher numbers are lower on the board, so we subtract the reward row</span>
    <span class="ruby-comment"># from the block row.</span>
    <span class="ruby-identifier">height_modifier</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">block</span>.<span class="ruby-identifier">getRow</span>() <span class="ruby-operator">-</span> <span class="ruby-ivar">@reward_row</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">height_modifier</span> * <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getHeightModifier-source -->
          
        </div>

        

        
      </div><!-- getHeightModifier-method -->

    
      <div id="method-i-getHeuristic" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getHeuristic</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>This function will evaluate a move based on the given tetromino's placement
on the board.  It will consider:</p>

<pre>holes beneath the tetromino
lines made by the move
blocks within the designated reward zone (below the highest block
  on the board before the move)
the distance between each tetromino block and the top of the reward
  zone
deep wells on the board (columns with 3 or more contiguous empty spaces)
moves that prematurely place a tetromino close to the top of the board.</pre>

<p>param tetromino is the tetromino location to use for the heuristic. return
the heuristic value given the board, tetromino, and reward row.</p>
          

          
          <div class="method-source-code" id="getHeuristic-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 149</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getHeuristic</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">heuristic</span> = <span class="ruby-identifier">getHolesBelowTetromino</span>(<span class="ruby-identifier">tetromino</span>) <span class="ruby-operator">+</span>
              <span class="ruby-identifier">getLinesMade</span>(<span class="ruby-identifier">tetromino</span>) <span class="ruby-operator">+</span>
              <span class="ruby-identifier">getBlocksInRewardZone</span>(<span class="ruby-identifier">tetromino</span>) <span class="ruby-operator">+</span>
              <span class="ruby-identifier">getHeightModifier</span>(<span class="ruby-identifier">tetromino</span>) <span class="ruby-operator">+</span>
              <span class="ruby-identifier">checkForDeepWells</span>(<span class="ruby-identifier">tetromino</span>) <span class="ruby-operator">+</span>
              <span class="ruby-identifier">checkForNearDeathPlacement</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">heuristic</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getHeuristic-source -->
          
        </div>

        

        
      </div><!-- getHeuristic-method -->

    
      <div id="method-i-getHighestOccupiedRow" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getHighestOccupiedRow</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>return the index of the highest non-empty row on the <a
href="Board.html">Board</a>. Note:  higher rows have lower indices.</p>
          

          
          <div class="method-source-code" id="getHighestOccupiedRow-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getHighestOccupiedRow</span>()
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-constant">Board</span><span class="ruby-operator">::</span><span class="ruby-constant">ROWS</span>
    <span class="ruby-identifier">row</span> = <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">getBoard</span>()[<span class="ruby-identifier">i</span>]
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">row</span>.<span class="ruby-identifier">count</span>(<span class="ruby-constant">Tetromino</span><span class="ruby-operator">::</span><span class="ruby-constant">EMPTY</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">count</span>())
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">i</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Board</span><span class="ruby-operator">::</span><span class="ruby-constant">ROWS</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getHighestOccupiedRow-source -->
          
        </div>

        

        
      </div><!-- getHighestOccupiedRow-method -->

    
      <div id="method-i-getHolesBelowTetromino" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getHolesBelowTetromino</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>param tetromino is the tetromino location to use for the heuristic. return
the number of holes below each block of the tetromino. Note:  holes will be
double counted for blocks of a tetromino in the same column.</p>
          

          
          <div class="method-source-code" id="getHolesBelowTetromino-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getHolesBelowTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-comment"># Add the temp tetromino to the board to calculate the heuristic.</span>
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">addTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">negative_h</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">tetromino</span>.<span class="ruby-identifier">getBlocks</span>().<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">column</span> = <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">getColumnBelowRow</span>(<span class="ruby-identifier">block</span>.<span class="ruby-identifier">getRow</span>(), <span class="ruby-identifier">block</span>.<span class="ruby-identifier">getColumn</span>()).<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>)
    <span class="ruby-identifier">column</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cell</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cell</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Tetromino</span><span class="ruby-operator">::</span><span class="ruby-constant">EMPTY</span>)
        <span class="ruby-identifier">negative_h</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Remove the temp tetromino from the board so it doesn't mess up</span>
  <span class="ruby-comment"># other heuristics.</span>
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">removeTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">getHighestOccupiedRow</span>() <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">UNSAFE_THRESHOLD</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">negative_h</span> * <span class="ruby-value">800</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">negative_h</span> * <span class="ruby-value">35</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getHolesBelowTetromino-source -->
          
        </div>

        

        
      </div><!-- getHolesBelowTetromino-method -->

    
      <div id="method-i-getLinesMade" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">getLinesMade</span><span
            class="method-args">(tetromino)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>param tetromino is the tetromino location to use for the heuristic. return
an almost arbitrarily large heuristic value (10000 * lines made) if the AI
is in danger of losing or can make a really high scoring move, or a
relatively high-weighted move based on the height of the board</p>
          

          
          <div class="method-source-code" id="getLinesMade-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">getLinesMade</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">row_indices</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-identifier">tetromino</span>.<span class="ruby-identifier">getBlocks</span>().<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">row_indices</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">block</span>.<span class="ruby-identifier">getRow</span>()))
      <span class="ruby-identifier">row_indices</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">block</span>.<span class="ruby-identifier">getRow</span>())
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">lines_made</span> = <span class="ruby-value">0</span>
  <span class="ruby-comment"># We need to add the tetromino to the board to see if it made lines.</span>
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">addTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  <span class="ruby-identifier">row_indices</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@board</span>.<span class="ruby-identifier">isLine?</span>(<span class="ruby-ivar">@board</span>.<span class="ruby-identifier">getBoard</span>()[<span class="ruby-identifier">row</span>]))
      <span class="ruby-identifier">lines_made</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Reset the board to how it was.</span>
  <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">removeTetromino</span>(<span class="ruby-identifier">tetromino</span>)
  
  <span class="ruby-comment"># Making lines becomes a very high priority when the highest row is</span>
  <span class="ruby-comment"># dangerously close to the top (higher row on the board means lower index number).</span>
  <span class="ruby-comment"># Big-scoring moves that make 3 or 4 lines are also prioritized.</span>
  <span class="ruby-identifier">highest_row</span> = <span class="ruby-identifier">getHighestOccupiedRow</span>()
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">lines_made</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">3</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">highest_row</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">NEAR_DEATH_THRESHOLD</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">lines_made</span> * <span class="ruby-value">10000</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">lines_made</span> * (<span class="ruby-constant">Board</span><span class="ruby-operator">::</span><span class="ruby-constant">ROWS</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">highest_row</span>) * <span class="ruby-value">40</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- getLinesMade-source -->
          
        </div>

        

        
      </div><!-- getLinesMade-method -->

    
      <div id="method-i-tryMoves" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tryMoves</span><span
            class="method-args">(rotation)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Try all possible moves for the given rotation of the tetromino param
rotation is the rotation to use for the tetromino in this set of attempted
moves Note:  The best move sequence found will be stored in @best_move, and
that move's heuristic will be stored in @best_heuristic when this function
finishes executing.</p>
          

          
          <div class="method-source-code" id="tryMoves-source">
            <pre><span class="ruby-comment"># File lib/artificial_intelligence.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tryMoves</span>(<span class="ruby-identifier">rotation</span>)
  <span class="ruby-comment"># Make a copy of the tetromino so we don't mess up later rotations if</span>
  <span class="ruby-comment"># there are any.</span>
  <span class="ruby-identifier">tetromino_copy</span> = <span class="ruby-constant">DeepClone</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-ivar">@tetromino</span>)
  
  <span class="ruby-identifier">sideways_moves</span> = <span class="ruby-value">0</span>
  
  <span class="ruby-comment"># Keep track of the last good move so we can reset to it</span>
  <span class="ruby-comment"># when we go too far.</span>
  <span class="ruby-identifier">previous_tetromino</span> = <span class="ruby-constant">DeepClone</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-identifier">tetromino_copy</span>)
  <span class="ruby-comment"># move the tetromino as far left as possible</span>
  <span class="ruby-keyword">while</span> (<span class="ruby-identifier">tetromino_copy</span>.<span class="ruby-identifier">moveLeft</span>() <span class="ruby-keyword">and</span>
         <span class="ruby-operator">!</span><span class="ruby-ivar">@board</span>.<span class="ruby-identifier">causesCollision?</span>(<span class="ruby-identifier">tetromino_copy</span>))
    <span class="ruby-identifier">sideways_moves</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">previous_tetromino</span>.<span class="ruby-identifier">moveLeft</span>()
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># tetromino went too far, so reset to previous_tetromino</span>
  <span class="ruby-identifier">tetromino_copy</span> = <span class="ruby-identifier">previous_tetromino</span>
  
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">down_moves</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">next_tet</span> = <span class="ruby-constant">DeepClone</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-identifier">tetromino_copy</span>)
    <span class="ruby-identifier">previous_tetromino</span> = <span class="ruby-constant">DeepClone</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-identifier">next_tet</span>)
    <span class="ruby-keyword">while</span> (<span class="ruby-identifier">next_tet</span>.<span class="ruby-identifier">moveDown</span>() <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@board</span>.<span class="ruby-identifier">causesCollision?</span>(<span class="ruby-identifier">next_tet</span>))
      <span class="ruby-identifier">down_moves</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">previous_tetromino</span>.<span class="ruby-identifier">moveDown</span>()
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># next_tet went too far, so reset to previous_tetromino</span>
    <span class="ruby-identifier">next_tet</span> = <span class="ruby-identifier">previous_tetromino</span>
    
    <span class="ruby-comment"># Add the tetromino to the board to do the heuristic</span>
    <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">addTetromino</span>(<span class="ruby-identifier">next_tet</span>)
    
    <span class="ruby-identifier">next_heuristic</span> = <span class="ruby-identifier">getHeuristic</span>(<span class="ruby-identifier">next_tet</span>)
    <span class="ruby-comment"># If this move is better than the current best, set the heuristic and</span>
    <span class="ruby-comment"># the instructions for making a better move.</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">next_heuristic</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@best_heuristic</span>)
      <span class="ruby-ivar">@best_heuristic</span> = <span class="ruby-identifier">next_heuristic</span>
      <span class="ruby-ivar">@best_move</span> = [<span class="ruby-identifier">rotation</span>, <span class="ruby-identifier">sideways_moves</span>, <span class="ruby-identifier">down_moves</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">sideways_moves</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-ivar">@board</span>.<span class="ruby-identifier">removeTetromino</span>(<span class="ruby-identifier">next_tet</span>)
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">while</span> (<span class="ruby-identifier">tetromino_copy</span>.<span class="ruby-identifier">moveRight</span>())
<span class="ruby-keyword">end</span></pre>
          </div><!-- tryMoves-source -->
          
        </div>

        

        
      </div><!-- tryMoves-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

